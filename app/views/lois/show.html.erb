<div class="site-container">
  <div id="form-paper">
    <div class="form-heading">
      <h1>
        LOI Submission Review 
        <div id="rating-pullout">
          <% if current_user.admin %>
            <% if current_user.ratings.find_by(loi_id: @loi.id) != nil %>

              <%= form_tag "/ratings/#{@rating.id}", method: :patch do %>

                  <div class="loi-rating-form">
                  <button type="button" class="btn btn-danger" data-toggle="collapse" data-target="#loi-ratings">Edit Rating</button>
                  <div id="loi-ratings" class="collapse">
                  
                    <form>
                      <hr>                  
                      <p class="rating-label">Fits SVP's Criteria:</p>
                      <%= select_tag(:q1, options_for_select([['1', 1], ['2', 2], ['3', 3], ['4', 4], ['5', 5]], selected: @rating.q1), :prompt => "Rate 1 - 5", class: "form-control loi-rating-form") %>
                      <hr>
                      <p class="rating-label"><%= label_tag "Potential SVP Impact:", nil %></p>
                      <%= select_tag(:q2, options_for_select([['1', 1], ['2', 2], ['3', 3], ['4', 4], ['5', 5]], selected: @rating.q2 ), :prompt => "Rate 1 - 5", class: "form-control loi-rating-form") %>
                      <hr>
                      
                      <p class="rating-label"><%= label_tag "Level of Excitement:", nil %></p>
                      <%= select_tag(:q3, options_for_select([['1', 1], ['2', 2], ['3', 3], ['4', 4], ['5', 5]], selected: @rating.q3 ), :prompt => "Rate 1 - 5", class: "form-control loi-rating-form") %>
                      <hr>
                    
                      <p class="rating-label"><%= label_tag "Benefit to SVP:", nil %></p>
                      <%= select_tag(:q4, options_for_select([['1', 1], ['2', 2], ['3', 3], ['4', 4], ['5', 5]], selected: @rating.q4 ), :prompt => "Rate 1 - 5", class: "form-control loi-rating-form") %>

                      <hr>
                      <p class="rating-label"><%= label_tag "Invite to Submit RFP:", nil %></p>
                      <%= select_tag(:q5, options_for_select([['Yes', 'Yes'], ['No', 'No'], ['Maybe', 'Maybe']], selected: @rating.q5 ), :prompt => "Select", class: "form-control loi-rating-form") %>

      
                      <%= hidden_field_tag :loi_id, @loi.id %> 
                      <%= submit_tag 'Edit', class: "btn btn-primary" %>

                    </form>
                  </div>
                  </div>
                <% end %>
              <% else %>
                <%= form_tag "/ratings", method: :post do %>

                  <div class="loi-rating-form">
                  <button type="button" class="btn btn-primary" data-toggle="collapse" data-target="#loi-ratings">Rate this LOI</button>
                  <div id="loi-ratings" class="collapse">
                  
                    <form>
                      <hr>                  
                      <p class="rating-label">Fits SVP's Criteria:</p>
                      <%= select_tag(:q1, options_for_select([['1', 1], ['2', 2], ['3', 3], ['4', 4], ['5', 5]], selected: @rating.q1), :prompt => "Rate 1 - 5", class: "form-control loi-rating-form") %>
                      <hr>
                      <p class="rating-label"><%= label_tag "Potential SVP Impact:", nil %></p>
                      <%= select_tag(:q2, options_for_select([['1', 1], ['2', 2], ['3', 3], ['4', 4], ['5', 5]], selected: @rating.q2 ), :prompt => "Rate 1 - 5", class: "form-control loi-rating-form") %>
                      <hr>
                      
                      <p class="rating-label"><%= label_tag "Level of Excitement:", nil %></p>
                      <%= select_tag(:q3, options_for_select([['1', 1], ['2', 2], ['3', 3], ['4', 4], ['5', 5]], selected: @rating.q3 ), :prompt => "Rate 1 - 5", class: "form-control loi-rating-form") %>
                      <hr>
                    
                      <p class="rating-label"><%= label_tag "Benefit to SVP:", nil %></p>
                      <%= select_tag(:q4, options_for_select([['1', 1], ['2', 2], ['3', 3], ['4', 4], ['5', 5]], selected: @rating.q4 ), :prompt => "Rate 1 - 5", class: "form-control loi-rating-form") %>

                      <hr>
                      <p class="rating-label"><%= label_tag "Invite to Submit RFP:", nil %></p>
                      <%= select_tag(:q5, options_for_select([['Yes', 'Yes'], ['No', 'No'], ['Maybe', 'Maybe']], selected: @rating.q5 ), :prompt => "Select", class: "form-control loi-rating-form") %>

      
                      <%= hidden_field_tag :loi_id, @loi.id %> 
                      <%= submit_tag 'Submit', class: "btn btn-primary" %>

                    </form>
                  </div>
                  </div>
                <% end %>

            <% end %>
          <% end %>
        </div>
        </h1>
    </div> 
      <div class="form-body">

        <div ng-app="app">

          <div ng-controller="loisCtrl" ng-init="setup()">
            <ol class="form-list">

            <!-- CONTACT SECTION -->

              <section class="section contact-section">
                <h3><li> Contact </li></h3>
                  <table class="table table-striped table-bordered">
                    <tr>
                      <td><b>Proposal Contact Name:</b></td>
                      <td>{{loi.name}}</td>
                    </tr>
                    <tr>
                      <td><b>Proposal Contact Email:</b></td>
                      <td>{{loi.email}}</td>
                    </tr>
                    <tr ng-repeat="answer in loi.contact_answers">
                      <td style="width: 20%">
                        <b>{{answer.question.question}}:</b>
                      </td>
                      <td>
                        {{answer.answer}}
                      </td>
                    </tr>
                  </table>
              </section>

            <!-- ORGANIZATION SECTION -->

              <section class="section organization-section">
                <h3><li> Organization </li></h3>
                  <table class="table table-striped table-bordered">
                    <tr ng-repeat="answer in loi.organization_answers">
                      <td style="width: 20%">
                        <b>{{answer.question.question}}:</b>
                      </td>
                      <td>
                        {{answer.answer}}
                      </td>
                    </tr>
                  </table>
              </section>

              <!-- OVERVIEW SECTION -->

              <section class="section overview-section">
                <h3><li> OVERVIEW </li></h3>
                  <table class="table table-striped table-bordered">
                    <tr ng-repeat="answer in loi.overview_answers">
                      <td style="width: 20%">
                        <b>{{answer.question.question}}:</b>
                      </td>
                      <td>
                        {{answer.answer}}
                      </td>
                    </tr>
                  </table>
              </section>

              <!-- VISION SECTION -->

              <section class="section vision-section">
                <h3><li> Vision </li></h3>
                  <table class="table table-striped table-bordered">
                    <tr ng-repeat="answer in loi.vision_answers">
                      <td style="width: 20%">
                        <b>{{answer.question.question}}:</b>
                      </td>
                      <td>
                        {{answer.answer}}
                      </td>
                    </tr>
                  </table>
              </section>

              <!-- KEY CONCERN SECTION -->

              <section class="section concern-section">
                <h3><li> Key Concerns </li></h3>
                  <table class="table table-striped table-bordered">
                    <tr ng-repeat="answer in loi.concern_answers">
                      <td style="width: 20%">
                        <b>{{answer.question.question}}:</b>
                      </td>
                      <td>
                        {{answer.answer}}
                      </td>
                    </tr>
                  </table>
              </section>

              <!-- CHALLENGE SECTION -->

              <section class="section">

                <h3><li>Organizational Capacity Challenges</li></h3>
                  <table class="table table-striped table-bordered">
                    <tr>
                      <th>Focus Area</th>
                      <th>Please provide a short description of your top 1-3 challenge(s) in each area that applies</th>
                      <th>Priority Rank each as High, Medium or Low</th>
                      <th colspan="3">
                        <table class="fte-header-table">
                          <tr>
                            <td colspan="3">Please provide the total amount of time you and your staff spend in each focus area expressd in FTEs</td>
                          </tr>
                          <tr>
                            <td>-</td>
                            <td>-</td>
                            <td>-</td>
                          </tr>
                          <tr>
                            <td>2015 Staffing (actual)</td>
                            <td>2016 Staffing (current)</td>
                            <td>2017 Staffing (projected)</td>
                          </tr>
                        </table>
                      </th>
                    </tr> 
                    <tr ng-repeat="answer in loi.challenge_answers">
                      <td><b>{{answer.question.question}}:</b></td>
                      <td>
                        <ol class="challenge-list">
                          <li ng-show="!answer.challenges[0].challenge==''"> {{answer.challenges[0].challenge}}</li>
                          <li ng-show="!answer.challenges[1].challenge==''"> {{answer.challenges[1].challenge}}</li>
                          <li ng-show="!answer.challenges[2].challenge==''"> {{answer.challenges[2].challenge}}</li>
                        </ol>
                      </td>
                      <td>
                        <ol class="challenge-list">
                          <li ng-show="!answer.challenges[0].priority==''">{{answer.challenges[0].priority}}</li>
                          <li ng-show="!answer.challenges[1].priority==''">{{answer.challenges[1].priority}}</li>
                          <li ng-show="!answer.challenges[2].priority==''">{{answer.challenges[2].priority}}</li>
                        </ol>
                      </td>
                      <td>{{answer.fte.amount_1}}</td>
                      <td>{{answer.fte.amount_2}}</td>
                      <td>{{answer.fte.amount_3}}</td>
                    </tr>
                    <tr>
                      <td colspan="3">TOTAL FTEs</td>
                      <td>{{fte_1}}</td>
                      <td>{{fte_2}}</td>
                      <td>{{fte_3}}</td>
                    </tr>
                  </table>
              </section>

              <!-- REFERRAL SECTION -->

              <section class="section concern-section">
                <h3><li> REFERRAL </li></h3>
                  <table class="table table-striped table-bordered">
                    <tr ng-repeat="answer in loi.referral_answers">
                      <td style="width: 20%">
                        <b>{{answer.question.question}}:</b>
                      </td>
                      <td>
                        {{answer.answer}}
                      </td>
                    </tr>
                  </table>
              </section>

              <div class="row">
            
                <!-- DEMOGRAPHIC SECTION -->

                <div class="col-md-6">
                  <section class="section demographic-section">
                    <h3><li> DEMOGRAPHICS </li></h3>
                      <table class="table table-striped table-bordered">
                        <tr>
                          <th>Sector</th>
                          <th>Please select if you programs addressing this sector</th>
                        </tr>
                        <tr ng-repeat="answer in loi.demographic_answers">
                          <td style="width: 20%">
                            <b>{{answer.question.question}}:</b>
                          </td>
                          <td>
                            {{answer.answer}}
                          </td>
                        </tr>
                      </table>
                  </section>
                </div>

                <!-- GEOGRAPHIC FOCUS SECTION -->

                <div class="col-md-6">
                  <section class="section geographic-section">
                    <h3><li> GEOGRAPHIC INFORMATION </li></h3>
                      <table class="table table-striped table-bordered">
                      
                          <tr>
                            <th>Geographic Focus</th>
                            <th>Please select whichever applies (if more than one, pick the one based on your main program)</th>
                          </tr>
                          <tr ng-repeat="answer in loi.geographic_answers">
                            <td style="width: 20%">
                              <b>{{answer.question.question}}:</b>
                            </td>
                            <td>
                              {{answer.answer}}
                            </td>
                          </tr>
                   
                      </table>
                  </section>
                </div>
              </div>

            </ol>
          </div>
        </div>

        <div class="btn-container">
          <% if user_signed_in? && current_user.admin %>
            <%= link_to "Rate", "/ratings/new?loi=#{@loi.id}", :class => "btn btn-danger", :role => "button" %>
          <% end %>
        </div>

    </div>
  </div>
</div>